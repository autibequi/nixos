# ===================================================================
#                          MONITOR CONFIGURATION
# ===================================================================
# ref: https://wiki.hyprland.org/Configuring/Monitors/

# Default monitor (fallback)
monitor = ,highres,auto,1.6

source = ~/.config/hypr/monitors.conf

$hyprutils = source ~/.config/hypr/hyprutils.sh &&

# ===================================================================
#                       WORKSPACE TO MONITOR BINDINGS
# ===================================================================
# Workspaces 1-6 always open on main monitor (DP-2)
workspace = 1, monitor:DP-2
workspace = 2, monitor:DP-2
workspace = 3, monitor:DP-2
workspace = 4, monitor:DP-2
workspace = 5, monitor:DP-2
workspace = 6, monitor:DP-2

# Workspaces 7-10 always open on secondary monitor (HDMI-A-1)
workspace = 7, monitor:HDMI-A-1
workspace = 8, monitor:HDMI-A-1
workspace = 9, monitor:HDMI-A-1
workspace = 10, monitor:HDMI-A-1

# ===================================================================
#                           PROGRAM ALIASES
# ===================================================================
$terminal          = alacritty
$fileManager       = nautilus -w
$menu              = anyrun
$lock              = hyprlock
$tesseract         = grim -g "$(slurp)" - | tesseract stdin stdout -l eng | wl-copy
$printScreen       = grim -g "$(slurp)" - | satty -f - --early-exit --fullscreen --copy-command wl-copy
$obsidian          = obsidian
$workBrowser       = chromium
$personalBrowser   = flatpak run app.zen_browser.zen
$workIde           = cursor
$zed               = zeditor
$displayManager    = nwg-displays
$networkManager    = nmtui
$audioManager      = ncpamixer
$workObsidian      = xdg-open "obsidian://open?vault=Work"
$personalObsidian  = xdg-open "obsidian://open?vault=books"
$gemini            = chromium --app=https://gemini.google.com
$calendar          = chromium --app=https://calendar.google.com
$chat              = chromium --app=https://chat.google.com
$passwordManager   = proton-pass

# ===================================================================
#                         EXECUTION COMMANDS
# ===================================================================
# Cursor
exec-once = hyprctl setcursor macOS 35

# Environment
exec-once = mkdir -p ~/.cache/hyprland
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

# Waybar
exec = $hyprutils waybar_refresh

# Wallpaper
exec-once = swww-daemon
exec-once = swww img ~/.wallpapers/dark.jpg --transition-fps 120 --transition-step 200

# Plugins/Other
exec-once = hyprshade auto
exec-once = hypridle

# Clipboard
exec-once = wl-paste --watch cliphist store

# ===================================================================
#                          PLUGIN SETTINGS
# ===================================================================
# Load all the plugins you installed
# exec-once = hyprctl plugin load "$HYPR_PLUGIN_DIR/lib/libhyprexpo.so"
plugin {
    hyprexpo {
        columns          = 3
        gap_size         = 10
        bg_col           = rgb(111111)
        workspace_method = first 1 # [center/first] [workspace] e.g. first 1 or center m+1

        enable_gesture   = true    # laptop touchpad
        gesture_fingers  = 3       # 3 or 4
        gesture_distance = 300     # how far is the "max"
        gesture_positive = false   # positive = swipe down. Negative = swipe up.
    }

    hyprspace {
        workspace_method = first 1 # [center/first] [workspace] e.g. first 1 or center m+1
    }
}

# ===================================================================
#                           INPUT SETTINGS
# ===================================================================
# exec-once = hyprctl plugin load "$HYPR_PLUGIN_DIR/lib/libhyprspace.so"
plugin {
    overview {
        onBottom    = true
        autoDrag    = true
        autoScroll  = true
        # switchOnDrop = true
        exitOnSwitch = false
        affectStrut  = false
    }
}

# Hyprspace keybinds (examples)
# bind = MOD3, Escape, killactive
# bind = SUPER, space, overview:toggle

# ===================================================================
#                  DYNAMIC CURSORS PLUGIN SETTINGS
# ===================================================================
exec-once = hyprctl plugin load "$HYPR_PLUGIN_DIR/lib/libhypr-dynamic-cursors.so"
plugin {
    dynamic-cursors {
        enabled   = true
        mode      = tilt
        threshold = 2

        rotate {
            length = 35
            offset = 0.0
        }

        tilt {
            limit    = 6000
            function = quadratic
            window   = 300
        }

        shake {
            enabled   = true
            nearest   = true
            threshold = 6.0
            base      = 2.0
            speed     = 1.0
            influence = 0.1
            limit     = 3.0
            timeout   = 100
            effects   = true
            ipc       = false
        }
    }
}

# ===================================================================
#                        HYPRTASKING PLUGIN SETTINGS
# ===================================================================
exec-once = hyprctl plugin load "$HYPR_PLUGIN_DIR/lib/libhyprtasking.so"
plugin {
    hyprtasking {
        layout           = grid
        exit_on_hovered  = false
        gap_size         = 20
        bg_color         = 0xff000000   # black
        border_size      = 10

        gestures {
            enabled        = true
            move_fingers   = 4
            move_distance  = 600
            open_fingers   = 3
            open_distance  = 400
            open_positive  = true
        }

        grid {
            rows                  = 2
            cols                  = 3
            loop                  = false
            gaps_use_aspect_ratio = false
        }

        linear {
            height        = 300
            scroll_speed  = 1.5
            blur          = true
            blur_size     = 8
            blur_passes   = 4
        }
    }
}

# Hyprtasking keybinds
bind = MOD3, Escape, hyprtasking:killhovered
bind = SUPER, Space, hyprtasking:toggle, all

# ===================================================================
#                           INPUT SETTINGS
# ===================================================================
# ref: https://wiki.hyprland.org/Configuring/Variables/
input {
    kb_layout    = us
    kb_variant   = altgr-intl
    kb_options   = caps:hyper # your caps is now MOD3, use wisely

    kb_model     =
    kb_rules     =

    follow_mouse     = 1
    accel_profile    = flat
    force_no_accel   = false

    repeat_rate = 25
    repeat_delay = 250

    touchpad {
        natural_scroll         = true
        disable_while_typing   = true
        tap-to-click           = true
        drag_lock              = false
        clickfinger_behavior   = false
    }

    # -1.0 - 1.0, 0 means no modification.
    sensitivity    = 0.0
    scroll_factor  = 0.7
}

# ===================================================================
#                        DECORATION SETTINGS
# ===================================================================
decoration {
    # See https://wiki.hyprland.org/Configuring/Variables/ for more

    rounding = 5

    blur {
        enabled = true
    }
}

# ===================================================================
#                        ANIMATION SETTINGS
# ===================================================================
animations {
    enabled = true

    bezier    = defaut, 0.10, 0.8, 0.2, 1.0
    bezier    = bounce, 0.34, 1.56, 0.64, 1

    animation = windows,      1, 2, bounce
    animation = windowsOut,   1, 2, bounce, popin 80%
    animation = border,       1, 3, bounce
    animation = borderangle,  1, 2, bounce
    animation = fade,         1, 2, bounce
    animation = workspaces,   1, 1, defaut
}

# ðŸ˜Ž HyperShaders made me do this
debug {
    damage_tracking = false
}

# ===================================================================
#                         LAYOUT SETTINGS
# ===================================================================
master {
    # See https://wiki.hyprland.org/Configuring/Master-Layout/ for more
}

# ===================================================================
#                        GESTURE SETTINGS
# ===================================================================
# gestures {
#     workspace_swipe = true
# }

# ===================================================================
#                     MISCELLANEOUS SETTINGS
# ===================================================================
misc {
    # kek!
    # https://github.com/hyprwm/hyprland-wiki/issues/193
    vfr = false # keep on for battery

    # Freesync and stuff
    vrr = 0 # keep off

    disable_hyprland_logo      = true
    mouse_move_enables_dpms    = true
    key_press_enables_dpms     = true
    enable_swallow             = true
    swallow_regex              = ^(Alacritty|foot|kitty|wezterm)$
    force_default_wallpaper    = -1 # Set to 0 or 1 to disable the anime mascot wallpapers
}

# ===================================================================
#                     WORKSPACE CONFIGURATION
# ===================================================================

# Autostart applications on workspaces
exec-once = [workspace 1 silent]   $workIde ~/projects/nixos
exec-once = [workspace 2 silent]   $workBrowser
exec-once = [workspace 9 silent]   $personalBrowser

# Workspaces 1-6: always on main monitor (DP-1)
workspace = 1,monitor:DP-1,default=true
workspace = 2,monitor:DP-1,default=true
workspace = 3,monitor:DP-1,default=true
workspace = 4,monitor:DP-1,default=true
workspace = 5,monitor:DP-1,default=true
workspace = 6,monitor:DP-1,default=true

# Workspaces 7-10: prefer HDMI-A-1, fallback to DP-2
workspace = 7,monitor:HDMI-A-1,default=true
workspace = 7,monitor:DP-2
workspace = 8,monitor:HDMI-A-1,default=true
workspace = 8,monitor:DP-2
workspace = 9,monitor:HDMI-A-1,default=true
workspace = 9,monitor:DP-2
workspace = 10,monitor:HDMI-A-1,default=true
workspace = 10,monitor:DP-2

# ===================================================================
#                          FLOAT RULES
# ===================================================================
windowrulev2 = suppressevent maximize, class:.*
windowrulev2 = float, title:^(satty )$
windowrulev2 = float, class:^(proton-pass)$
windowrulev2 = float, class:^(nwg-displays)$

# Smart gaps / no gaps when only one tiled window
windowrulev2 = noborder, floating:0, onworkspace:w[tv1] !special
windowrulev2 = rounding 0, floating:0, onworkspace:w[tv1] !special

# ===================================================================
#                  GENERAL WORKSPACE CONFIGURATION
# ===================================================================
general {
    gaps_in                  = 5
    gaps_out                 = 5
    border_size              = 4
    # Glass border effect: translucent gradient and light blur
    col.active_border        = rgba(ffffff99) rgba(99c2ff55) 60deg
    col.inactive_border      = rgba(22223333) rgba(99c2ff22) 60deg
    layout                   = dwindle # master or dwindle
    allow_tearing            = false
    resize_on_border         = true
    extend_border_grab_area  = 30
}


# ===================================================================
#                  SPECIAL WORKSPACES CONFIGURATION
# ===================================================================

# Bleh (Scratchpad) (super + grave)
workspace = special:bleh, gapsout:84, on-created-empty: $terminal
windowrulev2 = bordercolor rgb(222222) rgb(888888) 30deg, onworkspace:special:bleh
bind = SUPER, Grave, togglespecialworkspace, bleh
bind = SUPER SHIFT, Grave, movetoworkspacesilent, special:bleh

# Escaper
bindn = SUPER, Escape, exec, hyprctl dispatch togglespecialworkspace $(cat /tmp/last_special_workspace)

# Communications (super + F1)
workspace = special:F1, gapsout:84,on-created-empty: $chat
windowrulev2 = bordercolor rgba(34a853cc) rgba(1a3c1acc) 60deg, onworkspace:special:F1
bind = SUPER, F1, exec, $hyprutils switch_special_workspace F1
bind = SUPER SHIFT, F1, movetoworkspacesilent, special:F1

# Context (super + F2)
workspace = special:F2, gapsout:84, on-created-empty: $workObsidian
windowrulev2 = bordercolor rgba(7c3aedcc) rgba(a78bfaee) 75deg, onworkspace:special:F2
bind = SUPER, F2, exec, $hyprutils switch_special_workspace F2
bind = SUPER SHIFT, F2, movetoworkspacesilent, special:F2

# VideoCall (super + F3)
workspace = special:F3, gapsout:84, on-created-empty: $terminal
windowrulev2 = bordercolor rgba(00aff0cc) rgba(ffffffcc) 90deg, onworkspace:special:F3
bind = SUPER, F3, exec, $hyprutils switch_special_workspace F3
bind = SUPER SHIFT, F3, movetoworkspacesilent, special:F3

# The forbidden (super + F4)
workspace = special:F4, gapsout:84, on-created-empty: $terminal
windowrulev2 = bordercolor rgba(0052ccdd) rgba(f4f5f7cc) 120deg, onworkspace:special:F4
bind = SUPER, F4, exec, $hyprutils switch_special_workspace F4
bind = SUPER SHIFT, F4, movetoworkspacesilent, special:F4

# Music (super + F5)
workspace = special:F5, gapsout:84, on-created-empty: $terminal
windowrulev2 = bordercolor rgba(ff0000cc) rgba(282828cc) 150deg, onworkspace:special:F5
bind = SUPER, F5, exec, $hyprutils switch_special_workspace F5
bind = SUPER SHIFT, F5, movetoworkspacesilent, special:F5

# ===================================================================
#                          APP KEYBINDS
# ===================================================================

# App Control
bind = MOD3, Escape, killactive,
bind = MOD3, Delete, exit

# Quick Apps
bind = MOD3, Space, exec, $menu
bind = MOD3, t,     exec, $terminal
bind = MOD3, l,     exec, $lock
bind = MOD3, b,     exec, $workBrowser
bind = MOD3, c,     exec, $workIde
bind = MOD3, g,     exec, $gemini
bind = MOD3, e,     exec, $fileManager
bind = MOD3, p,     exec, $passwordManager
bind = MOD3, z,     exec, $zed

# Quick Apps Alternative (Shaders)
bind = MOD3, Page_Up,   exec, hyprshade next
bind = MOD3, Page_Down, exec, hyprshade prev

bind = MOD3 ALT, d, exec, hyprshade toggle ~/.config/hypr/shaders/drugs.glsl
bind = MOD3 ALT, o, exec, hyprshade toggle ~/.config/hypr/shaders/oled.frag
bind = MOD3 ALT, t, exec, hyprshade toggle ~/.config/hypr/shaders/catode.frag
bind = MOD3 ALT, c, exec, hyprshade toggle ~/.config/hypr/shaders/crt.glsl
bind = MOD3 ALT, g, exec, hyprshade toggle ~/.config/hypr/shaders/grain.frag

# ===================================================================
#                          TOOLS KEYBINDS
# ===================================================================

# System App Shortcuts
bind = SUPER, p,     exec, $displayManager
bind = SUPER, Comma, exec, $zed ~/projects/nixos  # NixOS Edit
bind = SUPER, r, exec, hyprctl reloadr

# Fullscreen
bind = SUPER, tab,     fullscreen, 1
bind = SUPER ALT, Tab, fullscreen, 0
bind = SUPER, F11,     fullscreenstate, 0 3

# Print Screen
bind = SUPER,       u, exec, $printScreen
bind = SUPER SHIFT, u, exec, $tesseract

# Super Float
bind = SUPER, f, togglefloating,

# Clipboard History (Anyrun)
bind = SUPER, v, exec, cliphist list | anyrun --show-results-immediately true --plugins libstdin.so | cliphist decode | wl-copy
bind = SUPER SHIFT, v, exec, cliphist wipe

# Dark Mode
bind = SUPER, n, exec, $hyprutils toggle_theme
bind = SUPER SHIFT, n, exec, hyprshade toggle

# ===================================================================
#                        WASD COMMANDS
# ===================================================================
# Focus movement (SUPER + WASD)
binde = SUPER, a, movefocus, l
binde = SUPER, d, movefocus, r
binde = SUPER, w, movefocus, u
binde = SUPER, s, movefocus, d

# Window movement within workspace (SUPER + SHIFT + WASD)
binde = SUPER SHIFT, a, movewindow, l
binde = SUPER SHIFT, d, movewindow, r
binde = SUPER SHIFT, w, movewindow, u
binde = SUPER SHIFT, s, movewindow, d

# Resize workspace (SUPER + ALT + WASD)
binde = SUPER ALT, a, resizeactive, -20 0
binde = SUPER ALT, d, resizeactive, 20 0
binde = SUPER ALT, w, resizeactive, 0 -20
binde = SUPER ALT, s, resizeactive, 0 20

# ===================================================================
#                        ARROWS COMMANDS (ergonomics)
# ===================================================================

# Focus movement (SUPER + ARROWS)
binde = SUPER, left,  movefocus, l
binde = SUPER, right, movefocus, r
binde = SUPER, up,    movefocus, u
binde = SUPER, down,  movefocus, d

# Window movement within workspace (SUPER + SHIFT + ARROWS)
binde = SUPER SHIFT, left,  movewindow, l
binde = SUPER SHIFT, right, movewindow, r
binde = SUPER SHIFT, up,    movewindow, u
binde = SUPER SHIFT, down,  movewindow, d

# Resize workspace (SUPER + CTRL + ARROWS)
binde = SUPER CTRL, left,  resizeactive, -20 0
binde = SUPER CTRL, right, resizeactive, 20 0
binde = SUPER CTRL, up,    resizeactive, 0 -20
binde = SUPER CTRL, down,  resizeactive, 0 20

# ===================================================================
#                        WINDOW MANAGEMENT
# ===================================================================

# Always escape the special workspaces every workspace switch
bind = SUPER, 1, exec, $hyprutils escape_workspace 1
bind = SUPER, 2, exec, $hyprutils escape_workspace 2
bind = SUPER, 3, exec, $hyprutils escape_workspace 3
bind = SUPER, 4, exec, $hyprutils escape_workspace 4
bind = SUPER, 5, exec, $hyprutils escape_workspace 5
bind = SUPER, 6, exec, $hyprutils escape_workspace 6
bind = SUPER, 7, exec, $hyprutils escape_workspace 7
bind = SUPER, 8, exec, $hyprutils escape_workspace 8
bind = SUPER, 9, exec, $hyprutils escape_workspace 9
bind = SUPER, 0, exec, $hyprutils escape_workspace 10

# Move windows to workspaces (SUPER + SHIFT + 1-0) silently
bind = SUPER SHIFT, 1, movetoworkspacesilent, 1
bind = SUPER SHIFT, 2, movetoworkspacesilent, 2
bind = SUPER SHIFT, 3, movetoworkspacesilent, 3
bind = SUPER SHIFT, 4, movetoworkspacesilent, 4
bind = SUPER SHIFT, 5, movetoworkspacesilent, 5
bind = SUPER SHIFT, 6, movetoworkspacesilent, 6
bind = SUPER SHIFT, 7, movetoworkspacesilent, 7
bind = SUPER SHIFT, 8, movetoworkspacesilent, 8
bind = SUPER SHIFT, 9, movetoworkspacesilent, 9
bind = SUPER SHIFT, 0, movetoworkspacesilent, 10

# ===================================================================
#                        MOUSE MANAGEMENT
# ===================================================================
bindm = SUPER, mouse:272, movewindow      # LMB
bindm = SUPER, mouse:273, resizewindow    # RMB

# ===================================================================
#                      MULTIMEDIA SETTINGS
# ===================================================================

# Audio controls
binde = , XF86AudioRaiseVolume, exec, wpctl set-volume -l 1.0 @DEFAULT_AUDIO_SINK@ 5%+
binde = , XF86AudioLowerVolume, exec, wpctl set-volume -l 1.0 @DEFAULT_AUDIO_SINK@ 5%-
bind  = , XF86AudioMute,        exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bind  = , XF86AudioMicMute,     exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bind  = , XF86AudioPlay,        exec, playerctl play-pause
bind  = , XF86AudioPause,       exec, playerctl play-pause
bind  = , XF86AudioNext,        exec, playerctl next
bind  = , XF86AudioPrev,        exec, playerctl previous

# Brightness controls
binde = , XF86MonBrightnessUp,   exec, brightnessctl set 2%+
binde = , XF86MonBrightnessDown, exec, brightnessctl set 2%-
